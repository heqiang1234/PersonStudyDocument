持久化：

redis为了保证效率，数据缓存到了内存中，但是会周期性的将更新的数据写入磁盘或者把修改操作写入追加的记录文件，以保证数据的持久化。

RDB:

直接将redis数据保存至一个dump文件，通过执行dump文件恢复数据。

工作原理：当redis需要做持久化的时候，会fork出一个子线程，子线程将数据写到磁盘的一个临时RDB文件中，当子进程完成临时文件后，将原来的RDB替换，这样可以实现 copy -on-write



优点：

可以保存多个版本的数据，便于灾难恢复，可以保存不同版本的数据

恢复数据的速度块，因为是一个二进制文件，直接执行

缺点:

可能会发生数据丢失，如果我们在备份的时候，突然死机，那么我们的数据就会丢失。



AOF:

将所有对redis服务器进行修改的命令保存到一个文件，命令的集合，redis默认是RDB的持久化方式。



工作原理：在使用AOF进行持久化的时候，每一个写命令都会通过write函数添加到 appendfsync.aof文件中，配置方式有下面三种：

1.appendfsync no	

2.appendfsync always		每一次执行写命令都保存写入到AOF文件

3.appendfsync everysrc    每一秒都同步一次，默认的策略

当redis重启时，将会读取aof文件的 命令，进行重写，恢复到redis关闭前的最后时刻。



优点：可以完整的将数据保存下来，就算丢失数据，也只会丢失一秒的数据，

缺点：文件比较大，因为每次执行写命令，都要写入到磁盘，如果写入巨大，会降低redis的性能。





数据库备份和灾难恢复：定时生成RDB快照，非常便于进行数据库的备份，并且RDB回复数据集的速度也要比AOF恢复的速度快。



Redis支持同时开启RDB和AOF，系统重启后，Redis会优先使用AOF来恢复数据，因为这样数据损失的会最少。